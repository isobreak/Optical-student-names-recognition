# Optical-student-names-recognition

Репозиторий содержит код алгоритма распознавания ФИО студентов по фотографии рукописного списка фамилий.

## Используемый подход к решению задачи
Итоговый пайплайн распознавания реализован в директории [inference.py](https://github.com/isobreak/Optical-student-names-recognition/blob/main/src/detection/inference.py) и состоит из 4 этапов:
1. **Детекция слов**
   - Реализовано 3 подхода к детекции, использующих в своей основе:
     - [**DBSCAN**](https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html): Кластеризует пиксели контуров на основе их расположения - каждый кластер принимается за детектированный объект. Требует доработки (оптимизированной кастомной метрики расстояния, учитывающей Y в большей степени, чем X). Чувствителен к качеству бинаризации изображения. Может использоваться на изображениях с низкой плотностью текста.
     - [**Морфологические трансформации**](https://docs.opencv.org/4.x/d9/d61/tutorial_py_morphological_ops.html): самый быстрый и наименее точный из методов. Чувствителен к качеству бинаризации изображения. Может использоваться на изображениях с низкой плотностью текста и строго горизонтальном расположении текста.
     - [**Faster R-CNN**](https://arxiv.org/pdf/1506.01497): лучшая точность на сложных данных среди использованных алгоритмов, наименьшая скорость. Используется в итоговом пайплайне (inference.py).

2. **Кластеризация слов**
   - Кластеризация осуществляется с целью разделения всех определенных объектов на группы, содержащие информацию об одном студенте. В предположении о том, что студенты расписываются в отдельных строках используется кластеризация по среднему значению Y с помощью [DBSCAN](https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html).

3. **Распознавание слов**
   - Используется [**TrOCR**](https://huggingface.co/raxtemur/trocr-base-ru) для распознавания текста в каждом боксе

4. **Сравнение ФИО**
   - Сравнение производится с использованием суммы [расстояний Левенштейна](https://ru.wikipedia.org/wiki/Расстояние_Левенштейна), нормированных на длину соответствующих слов. 

## Время обработки
Среднее время обработки: 5 секунд (на RTX 4070)

## Структура проекта

data<br />
├── images&emsp;&emsp;&emsp;#Использованные изображения листов с ФИО студентов<br />
├── results&emsp;&emsp;&emsp;#Изображения и данные, соответствующие каждому этапу пайплайна<br />
│   ├── clustering&emsp;&emsp;#Результаты кластеризации при различных eps (оптимальное значение: 8)<br />
│   ├── detection<br />
│   ├── optuna&emsp;&emsp;# Данные о подборе гиперпараметров<br />
│   ├── processing&emsp;#Результаты постобработки (для Faster R-CNN)<br />
│   └── recognition<br />
├── training&emsp;&emsp;#Данные обучения (на данный момент только графики обучения)<br />
│   └── plots<br />
└── student_names.txt&emsp;&emsp;#Список некоторых студентов (пока что используется вместо БД)<br />
src<br />
├── classic_detection&emsp;# Реализация классических подходов к детекции (реализованы [trackbars](https://docs.opencv.org/3.4/da/d6a/tutorial_trackbar.html) для настройки параметров обработки)<br />
│   ├── center_clustering.py&emsp;#Использование DBSCAN к центрам контуров: ускоряет обработку<br />
│   ├── dbscan_approach.py&emsp;#Использование DBSCAN для детекции<br />
│   └── dilation_approach.py&emsp;##Использование морфологических трансформаций для детекции<br />
└── detection&emsp;# Реализация детекции с помощью Faster R-CNN и итогового пайплайна<br />
│   ├── constants.py&emsp;#Константы, используемые в модуле detection<br />
│   ├── inference.py&emsp;# Итоговый пайплайн<br />
│   ├── models.py&emsp;# Используемые модели<br />
│   └── train.py&emsp;# Обучение Faster R-CNN на датасете [ai-forever/school_notebooks_RU](https://huggingface.co/datasets/ai-forever/school_notebooks_RU)<br />

## Инструкция по установке
&emsp;&emsp;pip install requirements.txt
